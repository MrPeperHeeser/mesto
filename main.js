!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);var r={formInputErrorClass:"popup__form-input_error",formInputErrorActiveClass:"popup__form-input-error_active",formButtonInactiveClass:"popup__form-btn_inactive",formButtonClass:"popup__form-btn",formInputClass:"popup__form-input",formClass:"popup__form"},o=document.querySelector(".popup__image-text"),i=document.querySelector(".popup__image"),a=document.querySelector(".popup__form-input_username-field"),u=document.querySelector(".popup__form-input_description-field"),s=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),f=document.querySelector(".popup__form_edit-profile"),p=document.querySelector(".popup__form_edit-avatar"),d=document.querySelector(".popup__form_add-photo"),h="/cards",_="/likes",m="/users/me",v="/avatar";function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(){function e(t){var n=this,r=t.data,o=t.selector,i=t.handleCardClick,a=t.handleDeleteClick,u=t.handleLikeClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"_getTemplate",(function(){return document.querySelector(n._selector).content.querySelector(".elements__element").cloneNode(!0)})),b(this,"_initChildElements",(function(){n._imgElement=n._element.querySelector(".elements__element-img"),n._titleElement=n._element.querySelector(".elements__text"),n._likesCountElement=n._element.querySelector(".elements__like-count"),n._removeCardButtonElement=n._element.querySelector(".elements__remove-btn"),n._likeButtonElement=n._element.querySelector(".elements__like-btn")})),b(this,"_setIsLiked",(function(){n._element.querySelector(".elements__like-btn").classList.add("elements__like-btn_liked")})),b(this,"_unsetIsLiked",(function(){n._element.querySelector(".elements__like-btn").classList.remove("elements__like-btn_liked")})),b(this,"_setEventListeners",(function(){n._likeButtonElement.addEventListener("click",n._handleLikeClick),n._imgElement.addEventListener("click",n._handleCardClick),n._removeCardButtonElement.addEventListener("click",n._handleDeleteClick)})),this._selector=o,this._data=r,this._handleCardClick=i,this._handleDeleteClick=a,this._handleLikeClick=u}var t,n,r;return t=e,(n=[{key:"isAlreadyLikedByUser",value:function(e){return!!this._data.likes.filter((function(t){return t._id===e}))[0]}},{key:"updateLikes",value:function(e){this.isAlreadyLikedByUser(e)?this._setIsLiked():this._unsetIsLiked(),this._likesCountElement.textContent=this._data.likes.length}},{key:"setData",value:function(e){e&&(this._data=e)}},{key:"renderElement",value:function(e){e===this._data.owner._id&&this._removeCardButtonElement.classList.add("elements__remove-btn_active"),this.updateLikes(e),this._imgElement.src=this._data.link,this._imgElement.alt=this._data.name,this._titleElement.textContent=this._data.name,this._element.id="CardID"+this._data._id}},{key:"generateCard",value:function(e){return this._element=this._getTemplate(),this._initChildElements(),this._setEventListeners(),this.renderElement(e),this._element}}])&&y(t.prototype,n),r&&y(t,r),e}();function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=document.querySelector(t),this._closeButtonElement=this._container.querySelector(".popup__close-button"),this._handleEscClose=this._handleEscClose.bind(this),this._handleOnOutsideClick=this._handleOnOutsideClick.bind(this),this.close=this.close.bind(this)}var t,n,r;return t=e,(n=[{key:"_handleOnOutsideClick",value:function(e){e.target.classList.contains("popup")&&this.close()}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){document.addEventListener("keydown",this._handleEscClose),this._container.addEventListener("click",this._handleOnOutsideClick),this._closeButtonElement.addEventListener("click",this.close)}},{key:"open",value:function(){this._container.classList.contains("popup_open")||(this.setEventListeners(),this._container.classList.add("popup_open"))}},{key:"close",value:function(){this._container.classList.contains("popup_open")&&(this._container.removeEventListener("click",this._handleOnOutsideClick),document.removeEventListener("keydown",this._handleEscClose),this._closeButtonElement.removeEventListener("click",this.close),this._container.classList.remove("popup_open"))}}])&&g(t.prototype,n),r&&g(t,r),e}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=j(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j(e);if(t){var o=j(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return O(this,n)}}function O(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(u,e);var t,n,r,a=L(u);function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),a.call(this,e)}return t=u,(n=[{key:"open",value:function(e){var t=e.src,n=e.name;i.src=t,i.alt=n,o.textContent=n,S(j(u.prototype),"open",this).call(this)}},{key:"close",value:function(){i.src="",i.alt="",o.textContent="",S(j(u.prototype),"close",this).call(this)}}])&&I(t.prototype,n),r&&I(t,r),u}(C);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return(T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=A(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A(e);if(t){var o=A(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return U(this,n)}}function U(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(i,e);var t,n,r,o=x(i);function i(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,e))._submitCallback=n,r._inputs=r._getInputs(),r._submitButtonContainer=r._container.querySelector(t),r._defaultSubmitButtonCapture=r._submitButtonContainer.textContent,r}return t=i,(n=[{key:"_getInputs",value:function(){return Array.from(this._container.getElementsByTagName("input"))}},{key:"getInputByInputTitle",value:function(e){var t=this._inputs.filter((function(t){return t.title===e}));return t&&1===t.length?t[0]:null}},{key:"setEventListeners",value:function(){T(A(i.prototype),"setEventListeners",this).call(this),this._container.addEventListener("submit",this._submitCallback)}},{key:"setWaiting",value:function(){this._submitButtonContainer.textContent="Сохранение..."}},{key:"setError",value:function(){this._submitButtonContainer.textContent="Ошибка!"}},{key:"close",value:function(){T(A(i.prototype),"close",this).call(this),this._submitButtonContainer.textContent=this._defaultSubmitButtonCapture,this._inputs.forEach((function(e){e.value=""})),this._container.removeEventListener("submit",this._submitCallback)}}])&&D(t.prototype,n),r&&D(t,r),i}(C);function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),R(this,"_showInputError",(function(e,t){var n=r._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(r._params.formInputErrorClass),n.textContent=t,n.classList.add(r._params.formInputErrorActiveClass)})),R(this,"_hideInputError",(function(e){var t=r._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(r._params.formInputErrorClass),t.classList.remove(r._params.formInputErrorActiveClass),t.textContent=""})),R(this,"_checkInputValidity",(function(e){e.validity.valid?r._hideInputError(e):r._showInputError(e,e.validationMessage)})),R(this,"_hasInvalidInput",(function(e){return e.some((function(e){return!e.validity.valid}))})),R(this,"_toggleButtonState",(function(e,t){r._hasInvalidInput(e)?t.classList.add(r._params.formButtonInactiveClass):t.classList.remove(r._params.formButtonInactiveClass)})),R(this,"_getInputList",(function(){return Array.from(r._formElement.querySelectorAll("."+r._params.formInputClass))})),R(this,"_getSubmitFormButton",(function(){return r._formElement.querySelector("."+r._params.formButtonClass)})),R(this,"_setEventListeners",(function(){var e=r._getInputList(),t=r._getSubmitFormButton();r._toggleButtonState(e,t,r._params),e.forEach((function(n){n.addEventListener("input",(function(){r._checkInputValidity(n,r._params),r._toggleButtonState(e,t,r._params)}))}))})),R(this,"enableValidation",(function(){r._setEventListeners()})),R(this,"resetValidation",(function(){var e=r._getInputList(),t=r._getSubmitFormButton();r._toggleButtonState(e,t,r._params),e.forEach((function(e){r._hideInputError(e)}))})),this._params=t,this._formElement=n};function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(t,n){var r=t.data,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderedItems=r,this._renderer=o,this._container=document.querySelector(n)}var t,n,r;return t=e,(n=[{key:"addItem",value:function(e,t){t?this._container.prepend(e):this._container.append(e)}},{key:"removeElementById",value:function(e){var t=document.getElementById(e);t&&t.remove()}},{key:"renderItems",value:function(){var e=this;this._renderedItems.forEach((function(t){e._renderer(t)}))}}])&&V(t.prototype,n),r&&V(t,r),e}();function W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var F=function(){function e(t){var n=t.userNameSelector,r=t.userDescriptionSelector,o=t.userAvatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userNameContainer=document.querySelector(n),this._userDescriptionContainer=document.querySelector(r),this._userAvatarContainer=document.querySelector(o)}var t,n,r;return t=e,(n=[{key:"getUserInfo",value:function(){return{userName:this._userNameContainer.textContent,userDescription:this._userDescriptionContainer.textContent,userId:this._id}}},{key:"getUserId",value:function(){return this._id}},{key:"setUserInfo",value:function(e){var t=e.userName,n=e.userDescription,r=e.avatarLink,o=e.id;this._userNameContainer.textContent=t||this._userNameContainer.textContent,this._userDescriptionContainer.textContent=n||this._userDescriptionContainer.textContent,this._userAvatarContainer.src=r||this._userAvatarContainer.src,this._id=o||this._id}},{key:"setAvatar",value:function(e){var t=e.avatarLink;this._userAvatarContainer.src=t||this._userAvatarContainer.src}}])&&W(t.prototype,n),r&&W(t,r),e}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var H,G=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}var t,n,r;return t=e,(n=[{key:"getInitialCards",value:function(){var e=this._baseUrl+h;return fetch(e,{headers:{authorization:this._headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("failed to get cards with status: "+e.status)})).catch((function(e){return console.log(e)}))}},{key:"addNewCard",value:function(e){var t=e.name,n=e.link,r=this._baseUrl+h;return fetch(r,{method:"POST",headers:{authorization:this._headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("failed to add new card with status: "+e.status)})).catch((function(e){return console.log(e)}))}},{key:"deleteCard",value:function(e){var t=e.id,n=this._baseUrl+h+"/"+t;return fetch(n,{method:"DELETE",headers:{authorization:this._headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("failed to delete card with status: "+e.status)})).catch((function(e){return console.log(e)}))}},{key:"getUserInfo",value:function(){var e=this._baseUrl+m;return fetch(e,{headers:{authorization:this._headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("failed to get user info with status: "+e.status)})).catch((function(e){return console.log(e)}))}},{key:"updateUserInfo",value:function(e){var t=e.name,n=e.about,r=this._baseUrl+m;return fetch(r,{method:"PATCH",headers:{authorization:this._headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("failed to update user info with status: "+e.status)})).catch((function(e){return console.log(e)}))}},{key:"updateAvatar",value:function(e){var t=e.avatarLink,n=this._baseUrl+m+v;return fetch(n,{method:"PATCH",headers:{authorization:this._headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("failed to update user avatar status: "+e.status)})).catch((function(e){return console.log(e)}))}},{key:"toggleLikeOnCard",value:function(e){var t,n=e.cardId;t=e.needLike?"PUT":"DELETE";var r=this._baseUrl+h+_+"/"+n;return fetch(r,{method:t,headers:{authorization:this._headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("failed to toggle like on card with status: "+e.status)})).catch((function(e){return console.log(e)}))}}])&&J(t.prototype,n),r&&J(t,r),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-15",headers:{authorization:"7b8cda84-c4a4-4b07-8b8b-e9e9b7230d9a","Content-Type":"application/json"}}),K=new B(".popup_open-photo"),Q=new N(".popup_delete-photo",".popup__form-btn",(function(e){e.preventDefault(),Q.setWaiting();var t=Q.getInputByInputTitle("id").value;G.deleteCard({id:t}).then((function(){H.removeElementById("CardID"+t),Q.close()})).catch((function(e){console.log(e),Q.setError()}))})),X=function(e){var t=new k({data:e,selector:"#card",handleCardClick:function(){K.open({src:e.link,name:e.name})},handleDeleteClick:function(){Q.getInputByInputTitle("id").value=e._id,Q.open()},handleLikeClick:function(){G.toggleLikeOnCard({cardId:e._id,needLike:!t.isAlreadyLikedByUser(Y.getUserId())}).then((function(e){t.setData(e),t.updateLikes(Y.getUserId())})).catch((function(e){return console.log(e)}))}});return t};G.getInitialCards().then((function(e){(H=new M({data:e,renderer:function(e){var t=X(e).generateCard(Y.getUserId());H.addItem(t,!1)}},".elements__list")).renderItems()})).catch((function(e){return console.log(e)}));var Y=new F({userNameSelector:".profile__username-text",userDescriptionSelector:".profile__description",userAvatarSelector:".profile__avatar"}),Z=new N(".popup_edit-profile",".popup__form-btn",(function(e){e.preventDefault(),Z.setWaiting(),G.updateUserInfo({name:a.value,about:u.value}).then((function(e){Y.setUserInfo({userName:e.name,userDescription:e.about}),Z.close()})).catch((function(e){console.log(e),Z.setError()}))})),$=new N(".popup_edit-avatar",".popup__form-btn",(function(e){e.preventDefault(),$.setWaiting(),G.updateAvatar({avatarLink:$.getInputByInputTitle("avatar-link").value}).then((function(e){Y.setAvatar({avatarLink:e.avatar}),$.close()})).catch((function(e){console.log(e),$.setError()}))})),ee=new N(".popup_add-photo",".popup__form-btn",(function(e){e.preventDefault(),ee.setWaiting(),G.addNewCard({name:ee.getInputByInputTitle("name").value,link:ee.getInputByInputTitle("link").value}).then((function(e){var t=X(e).generateCard(Y.getUserId());H.addItem(t,!0),ee.close()})).catch((function(e){console.log(e),ee.setError()}))})),te=new z(r,f),ne=new z(r,p),re=new z(r,d);G.getUserInfo().then((function(e){Y.setUserInfo({userName:e.name,userDescription:e.about,avatarLink:e.avatar,id:e._id})})).catch((function(e){return console.log(e)})),te.enableValidation(),re.enableValidation(),ne.enableValidation(),c.addEventListener("click",(function(){var e=Y.getUserInfo(),t=e.userName,n=e.userDescription;a.value=t,u.value=n,Z.open(),te.resetValidation()})),s.addEventListener("click",(function(){$.open(),ne.resetValidation()})),l.addEventListener("click",(function(){ee.open(),re.resetValidation()}))}]);